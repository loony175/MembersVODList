#!/bin/bash
echo "Downloading JSON file from Koudai48 API..."
temp=$(./pkt48 -r -L all -N)
memberId=$(awk -F "," '{print $2}' MemberID.csv | tail -n +2)
echo "$memberId" | while read line ; do
	memberName=$(awk -F "," "\$2==\"$line\" {print \$1}" MemberID.csv)
	memberID=$(echo "$line" | awk '{printf("%06d\n",$1)}')
	filename1="$memberID-$memberName.json"
	filename2="$memberID-$memberName.txt"
	echo "$temp" | jq "map(select(.memberId == $line))" > "../normal/$filename1"
	sum=$(cat "../normal/$filename1" | jq '.[] | .streamPath' | wc -l)
	echo "[normal] $sum URL(s) written in ../normal/$filename1"
	cat "../normal/$filename1" | jq '.[] | {(.startTime.dateTime): .streamPath}' | grep -Po '"[^{|}]*' > "../quiet/$filename2"
	echo "[quiet]  $sum URL(s) written in ../quiet/$filename2"
done
